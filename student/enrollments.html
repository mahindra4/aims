<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <a href="course.html">
            courses
        </a>
        <a href="enrollments.html">
            enrollements
        </a>
    </div>
    <h4 id="email"></h4>
    <h4>role: student</h4>
    <table>
        <thead>
            <tr bgcolor="gray">
                <th>instructor</th>
                <th>course</th>
                <th>status</th>
            </tr>
        </thead>
        <tbody id="student-selected-courses">

        </tbody>
    </table>
    <br>
    <button id="logout">logout</button>
    <script>
        const PORT = 33333
        const email = localStorage.getItem('email');
        document.getElementById("email").innerHTML = 'user: '+email;
        document.getElementById("logout").addEventListener('click',(event)=>{
            localStorage.removeItem('email')
            window.location = '../login.html'
        })
        async function syncronize(){
            try{
                const response = await fetch(`http://localhost:${PORT}/student_selected_courses/enrollments`,{
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email
                    })
                });
                const data = await response.json();
                tbody = document.getElementById('student-selected-courses');
                data.forEach(item => {
                    status = "-";
                    if(item.status == 'pia'){
                        status = 'pending instructor approval';
                    }
                    else if(item.status == 'pfa'){
                        status = 'pending faculty adivisor approval';
                    }
                    else{
                        status = item.status;
                    }
                    element = `
                        <tr bgcolor="lightgray">
                            <td>${item.instructor}</td>
                            <td>${item.course}</td>
                            <td>${status}</td>
                        </tr>
                    `
                    tbody.innerHTML+=element;
                })
            }
            catch(err){
                console.log('Error: '+err);
            }
        }
        syncronize()
    </script>
</body>
</html>